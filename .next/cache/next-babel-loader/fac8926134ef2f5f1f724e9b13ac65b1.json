{"ast":null,"code":"var __jsx = React.createElement;\nimport { Container, TextField, Grid, Paper, Button, Typography, Fab } from '@material-ui/core';\nimport { useRouter } from 'next/router';\nimport Link from 'next/link';\nimport { makeStyles } from '@material-ui/core/styles';\nimport React, { useState, useEffect, useRef } from \"react\";\nimport fetch from \"node-fetch\";\nimport ArrowBackIcon from '@material-ui/icons/ArrowBack';\nimport { error } from \"next/dist/build/output/log\";\nconst useStyles = makeStyles(theme => ({\n  header: {\n    paddingTop: '1rem'\n  },\n  fab: {\n    position: 'absolute',\n    bottom: theme.spacing(2),\n    left: theme.spacing(2)\n  }\n}));\n\nfunction Login(props) {\n  const {\n    0: username,\n    1: setUsername\n  } = useState();\n  const {\n    0: password,\n    1: setPassword\n  } = useState();\n  const {\n    0: missingError,\n    1: setMissingError\n  } = useState(false);\n  const {\n    0: loginError,\n    1: setLoginError\n  } = useState(false);\n  const classes = useStyles();\n  const router = useRouter();\n  useEffect(() => {\n    if (props.session !== null && props.query.refresh !== 'false') router.back();\n  }, [props.session]);\n  useEffect(() => {\n    props.setThemeBtn(false);\n    return () => {\n      props.setThemeBtn(true);\n    };\n  }, []);\n\n  function checkStatus(res) {\n    if (res.ok) {\n      // res.status >= 200 && res.status < 300\n      return res;\n    } else {\n      if (res.status === 401) setLoginError(true);\n      throw error(res.status);\n    }\n  }\n\n  const submitForm = () => {\n    setLoginError(false);\n    setMissingError(false);\n\n    if (!username || !password) {\n      setMissingError(true);\n    } else {\n      fetch(\"http://a2017sedlja.delta-studenti.cz/projektAPI/validate.php\", {\n        method: \"POST\",\n        headers: {\n          USERNAME: username,\n          PASSWORD: password\n        }\n      }).then(checkStatus).then(r => r.json()).then(j => {\n        if (j.error) {\n          cosnole.log(j.error);\n        } else {\n          props.changeSess({\n            session: j[0],\n            edit: j[1]\n          });\n          router.push('/');\n        }\n      });\n    }\n  };\n\n  return __jsx(\"div\", null, __jsx(Grid, {\n    container: true,\n    direction: \"row\",\n    justify: \"center\",\n    alignItems: \"center\",\n    style: {\n      minHeight: '100vh',\n      position: 'absolute'\n    }\n  }, __jsx(Container, {\n    maxWidth: \"xs\"\n  }, __jsx(Paper, {\n    className: classes.paper\n  }, __jsx(\"form\", {\n    method: \"post\",\n    onSubmit: e => {\n      e.preventDefault();\n      submitForm();\n    }\n  }, __jsx(Grid, {\n    container: true,\n    direction: \"column\",\n    justify: \"center\",\n    alignItems: \"center\",\n    spacing: 2\n  }, __jsx(Typography, {\n    className: classes.header,\n    variant: \"h4\"\n  }, \"Login\"), __jsx(Grid, {\n    item: true\n  }, __jsx(TextField, {\n    error: !username && missingError || loginError,\n    fullWidth: true,\n    helperText: !username && missingError ? \"required\" : null,\n    variant: \"outlined\",\n    label: \"Username\",\n    type: \"text\",\n    onChange: e => {\n      setUsername(e.target.value);\n    },\n    name: \"username\"\n  })), __jsx(Grid, {\n    item: true\n  }, __jsx(TextField, {\n    error: !password && missingError || loginError,\n    fullWidth: true,\n    helperText: !password && missingError ? \"required\" : null,\n    variant: \"outlined\",\n    label: \"Password\",\n    type: \"password\",\n    onChange: e => {\n      setPassword(e.target.value);\n    },\n    name: \"password\"\n  })), __jsx(Grid, {\n    item: true\n  }, __jsx(\"input\", {\n    style: {\n      display: \"none\"\n    },\n    id: \"submit-btn\",\n    type: \"submit\"\n  }), __jsx(\"label\", {\n    htmlFor: \"submit-btn\"\n  }, __jsx(Button, {\n    variant: \"contained\",\n    color: \"primary\",\n    component: \"span\"\n  }, \"Login\")))))), props.session !== null ? __jsx(Fab, {\n    onClick: () => {\n      router.back();\n    },\n    variant: \"extended\",\n    color: \"secondary\",\n    className: classes.fab\n  }, __jsx(ArrowBackIcon, null), \"Back to app\") : null)));\n}\n\nLogin.getInitialProps = ({\n  query\n}) => {\n  return {\n    query: query\n  };\n};\n\nexport default Login;","map":null,"metadata":{},"sourceType":"module"}